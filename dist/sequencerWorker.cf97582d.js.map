{"version":3,"sources":["interface.ts","Zic/sequencerWorker.ts"],"names":[],"mappings":"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","file":"sequencerWorker.cf97582d.js","sourceRoot":"../src","sourcesContent":["export const MAX_STEPS_PER_BEAT = 8;\nexport const STEP_TICK = 1 / MAX_STEPS_PER_BEAT;\n\nexport enum ActionWorker {\n    save,\n    remove,\n}\n\nexport interface MsgWorker {\n    action: ActionWorker;\n    data: DataInWorker[];\n}\n\nexport interface DataInWorker {\n    id: string;\n    outputId: string;\n    trigger: number;\n    duration: number;\n    slide?: boolean;\n    on: any;\n    off: any;\n}\n\nexport interface DataOutWorker {\n    id: string;\n    outputId: string;\n    data: any;\n}\n","import {\n    ActionWorker,\n    MAX_STEPS_PER_BEAT,\n    MsgWorker,\n    DataInWorker,\n    DataOutWorker,\n} from '../interface';\n\nconst ms = 75;\nlet counter = 0;\nconst stepsCount = MAX_STEPS_PER_BEAT * 4;\nconst list: DataInWorker[][] = [];\nfor (let n = 0; n < stepsCount; n++) {\n    list[n] = [];\n}\n\nself.addEventListener(\n    'message',\n    ({ data }: { data: MsgWorker }) => {\n        if (data.action === ActionWorker.save) {\n            saveSequences(data.data);\n        } else if (data.action === ActionWorker.remove) {\n            removeSequences(data.data);\n        }\n    },\n    false,\n);\n\nfunction findSequence(sequence: DataInWorker) {\n    for (let trigger = 0; trigger < list.length; trigger++) {\n        const index = list[trigger].findIndex(({ id }) => id === sequence.id);\n        if (index !== -1) {\n            return { trigger, index };\n        }\n    }\n}\n\nfunction saveSequences(sequences: DataInWorker[]) {\n    sequences.forEach((sequence) => {\n        const pos = findSequence(sequence);\n        if (pos) {\n            if (pos.trigger !== sequence.trigger) {\n                list[pos.trigger].splice(pos.index, 1);\n            }\n            list[sequence.trigger][pos.index] = sequence;\n        } else {\n            list[sequence.trigger].push(sequence);\n        }\n    });\n}\n\nfunction removeSequences(sequences: DataInWorker[]) {}\n\nfunction post(msg: DataOutWorker) {\n    (self as any).postMessage(msg);\n}\n\nsetInterval(() => {\n    counter = (counter + 1) % stepsCount;\n    list[counter].forEach(({ on, off, duration, slide, ...msg }) => {\n        post({ ...msg, data: on });\n        setTimeout(\n            () => post({ ...msg, data: off }),\n            ms * (duration + (slide ? 5 : 0)),\n        );\n    });\n}, ms);\n"]}